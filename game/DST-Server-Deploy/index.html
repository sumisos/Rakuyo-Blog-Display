<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ews.ink","root":"/","scheme":"Pisces","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta name="description" content="前言 基友突然想玩饥荒，就搞了一个，有确说实，真的不难 不需要编程知识，要一点运维基础（但动手能力稍微强一点，自给自足没有任何问题，不用怕）   就算搜索筛选能力不太好，我在写本文之前已经基本把坑都趟过一遍了，照着本教程一步一步做就行   如果照着做完依然不行……我只能说缘分没到，奉劝居士不必强求">
<meta property="og:type" content="article">
<meta property="og:title" content="「游戏」有手就行的《饥荒联机版》专用服务器搭建及配置教程">
<meta property="og:url" content="https://ews.ink/game/DST-Server-Deploy/index.html">
<meta property="og:site_name" content="非典型中二征候群">
<meta property="og:description" content="前言 基友突然想玩饥荒，就搞了一个，有确说实，真的不难 不需要编程知识，要一点运维基础（但动手能力稍微强一点，自给自足没有任何问题，不用怕）   就算搜索筛选能力不太好，我在写本文之前已经基本把坑都趟过一遍了，照着本教程一步一步做就行   如果照着做完依然不行……我只能说缘分没到，奉劝居士不必强求">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/04/09/APCvgYbsUqf1nBI.png">
<meta property="og:image" content="https://i.loli.net/2020/04/09/oibBavGk2sIZ9cf.jpg">
<meta property="og:image" content="https://i.loli.net/2020/04/09/WxPgJ4ZqSh1zwjA.jpg">
<meta property="og:image" content="https://i.loli.net/2020/04/09/LX9KVNPoHlDgbmI.jpg">
<meta property="og:image" content="https://i.loli.net/2020/04/09/gDv6noF7drPxVfq.png">
<meta property="og:image" content="https://i.loli.net/2020/04/09/mLPNolpSvkjE457.png">
<meta property="og:image" content="https://i.loli.net/2020/04/09/iqTdz8WjMGURhI9.png">
<meta property="article:published_time" content="2020-04-08T04:33:06.000Z">
<meta property="article:modified_time" content="2020-07-02T10:31:56.144Z">
<meta property="article:author" content="Cyanashi">
<meta property="article:tag" content="服务端">
<meta property="article:tag" content="饥荒">
<meta property="article:tag" content="饥荒联机版">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/04/09/APCvgYbsUqf1nBI.png">

<link rel="canonical" href="https://ews.ink/game/DST-Server-Deploy/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>「游戏」有手就行的《饥荒联机版》专用服务器搭建及配置教程 | 非典型中二征候群</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162156040-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-162156040-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">非典型中二征候群</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">康复中心<br>Everybody Wants Some</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-todos">

    <a href="/todos/" rel="section"><i class="fa fa-fw fa-list"></i>企划</a>

  </li>
        <li class="menu-item menu-item-games">

    <a href="/games/" rel="section"><i class="fa fa-fw fa-gamepad"></i>游戏</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ews.ink/game/DST-Server-Deploy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Cyanashi">
      <meta itemprop="description" content="Always Sometimes Monsters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="非典型中二征候群">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          「游戏」有手就行的《饥荒联机版》专用服务器搭建及配置教程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-08 12:33:06" itemprop="dateCreated datePublished" datetime="2020-04-08T12:33:06+08:00">2020-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-02 18:31:56" itemprop="dateModified" datetime="2020-07-02T18:31:56+08:00">2020-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">游戏</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul>
<li>基友突然想玩饥荒，就搞了一个，有确说实，真的不难</li>
<li>不需要编程知识，要一点运维基础（但动手能力稍微强一点，自给自足没有任何问题，不用怕）  </li>
<li>就算搜索筛选能力不太好，我在写本文之前已经基本把坑都趟过一遍了，照着本教程一步一步做就行  </li>
<li>如果照着做完依然不行……我只能说缘分没到，奉劝居士不必强求  </li>
</ul>
<a id="more"></a>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><h3 id="时效性"><a href="#时效性" class="headerlink" title="时效性"></a>时效性</h3><p>po亲手测试以及本文写就时间为2020年4月8日，根据时间流逝也许会逐渐与实际情况产生出入，请酌情食用。<br><del>用人话说，我写完没打算更了</del></p>
<h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p>本文实测环境为阿里云ECS，CentOS 7.7。<del>阿里云centos基本都是这个，祖传镜像</del><br>P.S. <code>lsb_release -a</code>可查看系统版本  </p>
<h3 id="能用树莓派跑吗"><a href="#能用树莓派跑吗" class="headerlink" title="能用树莓派跑吗"></a>能用树莓派跑吗</h3><p>和所有rpi玩家一样，我第一反应就是树莓派。<br>然而如果你和我一样没有选择官方Raspbian而是刷了第三方64位Debian的话，你应该也会遇到和我一样的问题：第一步apt安装依赖包的时候就尬住了，找不到/版本不匹配。<br>但理论上应该是可行的，打个比方，提示 <code>E: Unable to locate package lib32gcc1</code> 的「<a href="https://packages.debian.org/zh-cn/sid/libgcc1" target="_blank" rel="noopener">libgcc1 其实 1:10 版本支持 arm64架构</a>」，解决方案可参考「<a href="https://gitee.com/openfans-community/Debian-Pi-Aarch64/blob/master/README_zh.md#3-162%E4%BD%BF%E7%94%A8apt%E5%91%BD%E4%BB%A4%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85%E6%97%B6%E7%89%88%E6%9C%AC%E4%B8%8D%E5%8C%B9%E9%85%8D" target="_blank" rel="noopener">Debian Pi Aarch64 常见问题</a>」。<br>由于我的树莓派已经算半个生产环境了，所以没继续折腾，有兴趣的小伙伴可以深入研究一下。</p>
<h3 id="本文篇幅问题"><a href="#本文篇幅问题" class="headerlink" title="本文篇幅问题"></a>本文篇幅问题</h3><p>我是真的没想到写出来有这么长，我毕业论文字数可能都没这么多。<br><strong>请善用目录和Ctrl+F。</strong></p>
<h2 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h2><p>如果真的有零基础的小伙伴看的话，科普一下，Linux是信奉「less is more」的。<br><strong>没有消息就是好消息。</strong><br>更通俗点说，如果你在Linux的输入没有任何回显信息，不要慌，这说明你的操作完全成功了；<br>如果有回显，说明上一步操作多少有点问题。<br>（当然也不是绝对，一些长时间运行/状态多变的程序肯定会持续输出log，不必硬杠。）<br>OK的话，Let’s GO。  </p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>64位CentOS：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install glibc.i686 libstdc++.i686 libcurl.i686</span><br></pre></td></tr></table></figure>

<p>64位Debian使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386 lib32gcc1</span><br></pre></td></tr></table></figure>
<p>除了安装依赖之外，后面的命令应该是一样的，但<strong>并未在Debian实际测试过</strong>，如果使用Debian出现问题请参考本教程自行解决。</p>
<h3 id="安装-CMD-版-Steam"><a href="#安装-CMD-版-Steam" class="headerlink" title="安装 CMD 版 Steam"></a>安装 CMD 版 Steam</h3><p>开服并不需要Steam账号，但下载和更新DST服务端需要Steam，SteamCMD就是命令行版Steam客户端，所以要先装这个。</p>
<p>另外如果直接使用root用户运行服务端可能会导致严重的安全隐患，我们新建一个用户专门来负责这方面。<br>名字当然可以随便取，（因为还跑了l4d2）我就取steam了，如果你使用了另外的名字，之后请注意替换对应的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ useradd -m steam <span class="comment"># 新建一个名为steam的用户</span></span><br><span class="line">$ su - steam <span class="comment"># 切换到steam用户</span></span><br></pre></td></tr></table></figure>

<p>新建一个文件夹专门放SteamCMD：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ~/steamcmd <span class="comment"># 创建目录</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/steamcmd <span class="comment"># 进入该目录</span></span><br></pre></td></tr></table></figure>

<p>下载并解压SteamCMD：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz <span class="comment"># 下载压缩包</span></span><br><span class="line">$ tar -xvzf steamcmd_linux.tar.gz <span class="comment"># 解压</span></span><br></pre></td></tr></table></figure>

<p>初次运行SteamCMD：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./steamcmd.sh</span><br></pre></td></tr></table></figure>

<h3 id="安装DST（饥荒联机版）服务端"><a href="#安装DST（饥荒联机版）服务端" class="headerlink" title="安装DST（饥荒联机版）服务端"></a>安装DST（饥荒联机版）服务端</h3><p>首先匿名登录 SteamCMD：（用真实账号登录没有必要也没有意义）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Steam&gt; login anonymous</span><br></pre></td></tr></table></figure>

<p>强制指定安装路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Steam&gt; force_install_dir ../</span><br></pre></td></tr></table></figure>

<p>下载/更新饥荒联机版服务端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Steam&gt; app_update 343050 validate</span><br></pre></td></tr></table></figure>

<p>最后提示<code>Success! App &#39;343050&#39; fully installed.</code>即为安装完成，然后退出SteamCMD：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Steam&gt; quit</span><br></pre></td></tr></table></figure>

<p>现在硬性条件就算准备完成了，理论上已经可以运行饥荒服务端了，是不是很简单？<br>但如果要把饥荒服务端自定义成想要的样子，还有一部分重要内容。</p>
<h3 id="服务端架构简介"><a href="#服务端架构简介" class="headerlink" title="服务端架构简介"></a>服务端架构简介</h3><p>首先科普一下基础，饥荒联机版（Don’t Starve Together，简称DST）服务端是集群架构。<br>典型的有三种设计，我尽量浅显的介绍一下，有一个形象的认知之后会方便很多。<br>大概了解运行模式之后对之后的每个步骤做了什么、为什么要这样做，心里比较有数。</p>
<p>首先给完全零基础的小伙伴介绍一下术语：（在<strong>本文</strong>的<strong>大部分语境</strong>中）</p>
<ul>
<li>服务器（server）：一般指实际存在的物理机；打个比方，假如把搭DST服务端当成运行「一个应用」，服务器相当于你的电脑</li>
<li>集群（cluster）：也就是DST所谓的「专用服务器」；用上面的比喻来说，集群相当于「这个应用」</li>
<li>分片服务端（shard）：在物理机服务器上运行的、真正干活的程序；相当于「这个应用」的一个个子进程</li>
</ul>
<blockquote>
<p>如果是租用的服务器（VPS），实际上基本都是虚拟机，但使用起来可以<strong>视为</strong>物理机，具体不再继续展开</p>
</blockquote>
<p><img src="https://i.loli.net/2020/04/09/APCvgYbsUqf1nBI.png" alt="举例"><br>区别只在于「饥荒服务器」提供的是「在线游戏」服务，「浏览器」提供的是「网上冲浪」服务。</p>
<blockquote>
<p>以下图片来自「<a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1616647350" target="_blank" rel="noopener">Dedicated Server配置项和命令行参数详解</a>」，感谢大佬形象直观的绘图。</p>
</blockquote>
<h4 id="单服务器单集群"><a href="#单服务器单集群" class="headerlink" title="单服务器单集群"></a>单服务器单集群</h4><p><img src="https://i.loli.net/2020/04/09/oibBavGk2sIZ9cf.jpg" alt="单服务器单集群架构"><br>最简单最好理解的一种架构。  </p>
<p>在一台服务器（物理机）上跑整个集群。<br>一个集群里有两个服务端（有时候也可以直接称之为服务器，因为饥荒游戏客户端不会在乎这台物理机服务器上提供了别的任何——它根本不需要——的服务，所以对饥荒游戏客户端来说它就相当于整个服务器）。<br>这两个分片服务端（或者说抽象意义上的服务器），分别是主服务器（Master，地面服务器，或者说地上服务器）和从服务器（Slave，饥荒这个使用场景中即地穴服务器，或者说洞穴服务器 Caves）。  </p>
<p>但这种架构有一个问题，如果服务器（物理机）机能有限，与主世界实时同步运行的地穴服务器也许会吃掉所剩不多的服务器（物理机）资源，导致游玩体验卡顿。  </p>
<blockquote>
<p>一种很委屈的妥协方案是直接不开地穴服务器。（金子靠猪王，石头靠流星，远古靠缘分……）  </p>
</blockquote>
<p>那么除了换成性能更好（可能价格也贵得多）的服务器（物理机）之外，有没有别的解决方案呢？</p>
<h4 id="多服务器单集群"><a href="#多服务器单集群" class="headerlink" title="多服务器单集群"></a>多服务器单集群</h4><p><img src="https://i.loli.net/2020/04/09/WxPgJ4ZqSh1zwjA.jpg" alt="多服务器单集群"><br>有，性价比最高也最广为人知的就是分布式（极简Version）。<br>使用两台服务器（物理机），分别运行主服务器和地穴服务器，共同分担一个集群的任务。<br>一台服务器专门跑地面，另一台专门跑地穴，那么两台服务器（物理机）的配置都不需要太高。</p>
<p>但假如你有一台性能强大的服务器（物理机）专门运行饥荒服务端，根本不需要多台服务器（物理机）。<br>跑个20人饥荒服务器而已，不费吹灰之力，再跑几个都没问题。<br>那么有没有可以榨干机能的方案？</p>
<h4 id="单服务器多集群"><a href="#单服务器多集群" class="headerlink" title="单服务器多集群"></a>单服务器多集群</h4><p><img src="https://i.loli.net/2020/04/09/LX9KVNPoHlDgbmI.jpg" alt="单服务器多集群"><br>有，如果服务器（物理机）方面没有问题，可以在同一台服务器（物理机）上同时运行数个集群，并且多个集群之间可以联通。<br>一些很专业的服务器（饥荒服务端）可以做到主服务器只用来接待，通过权限验证和玩家选择之后再把玩家送进对应的专属服务器。<br>游玩体验类似Minecraft的多世界，成功登录主服务器后可以分发到各个不同主题的功能性服务器，比如原版纯生存世界、RPG世界、PVP竞技世界；<br>或者分周目：虽然现在已经三周目了，但如果你想，随时可以回到一周目/二周目继续游玩。  </p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><strong>「这一部分是不是太多不必要的废话了？我就开个服而已，能跑就行，有必要了解一大堆运行原理吗？」</strong>  </p>
<p>如果你顺利部署好了服务器并成功游玩，恭喜你，enjoy it。你说得对，叉掉这个页面吧。  </p>
<p>如果你部署过程中不太顺利，不幸遇到了莫名其妙的问题，又不知道从何处下手排查，面对网上一大堆乍一看什么都有但其实八成内容雷同的「<strong>教程</strong>」一筹莫展的时候，是绝对不会嫌基础资料多的。</p>
<p>总而言之，假如以上内容你都看完了，现在应该对饥荒服务端的运行机制有一定了解了，下面正式开始编辑配置。</p>
<h3 id="cluster-token-txt-集群-Token"><a href="#cluster-token-txt-集群-Token" class="headerlink" title="cluster_token.txt 集群 Token"></a>cluster_token.txt 集群 Token</h3><p>和<code>cluster.ini</code>位于同一目录下，没有就自己新建。</p>
<p>如何获取自己的token？</p>
<h4 id="网页获取"><a href="#网页获取" class="headerlink" title="网页获取"></a>网页获取</h4><p>进入游戏，点击左下角的「账号」打开Steam内置浏览器，等待网页加载结束后从「用户信息」切换到「游戏」标签，点击右上角的「饥荒联机版的游戏服务器」。<br>有就复制粘贴，没有就新建一个再复制粘贴。</p>
<h4 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h4><p>运行<code>TheNet:GenerateClusterToken()</code>命令，生成的token在<code>%USERPROFILE%\我的文档\Klei\DoNotStarveTogether\cluster_token.txt</code>里。</p>
<blockquote>
<p>下面两节内容大部分参考自「<a href="https://forums.kleientertainment.com/forums/topic/64552-dedicated-server-settings-guide/" target="_blank" rel="noopener">Dedicated Server Settings Guide</a>」</p>
</blockquote>
<h3 id="cluster-ini-集群配置"><a href="#cluster-ini-集群配置" class="headerlink" title="cluster.ini 集群配置"></a>cluster.ini 集群配置</h3><p>一口吃不成胖子，如果你上来就想一气呵成直接把双服务器同时搞定——<br>意味着可能会出问题的几率翻番，debug的成本也要提高一倍。<br>反正我是不建议赌这个几率，建议先从「单服务器单集群」这种方案开始测试。  </p>
<p>cluster.ini标准模板：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[GAMEPLAY]</span><br><span class="line">game_mode &#x3D; endless</span><br><span class="line">max_players &#x3D; 6</span><br><span class="line">pvp &#x3D; false</span><br><span class="line">pause_when_empty &#x3D; true</span><br><span class="line"></span><br><span class="line">[NETWORK]</span><br><span class="line">cluster_name &#x3D; 服务器名字</span><br><span class="line">cluster_description &#x3D; 服务器描述信息</span><br><span class="line">cluster_password &#x3D; 服务器密码</span><br><span class="line">cluster_intention &#x3D; cooperative</span><br><span class="line">cluster_language &#x3D; zh</span><br><span class="line"></span><br><span class="line">[MISC]</span><br><span class="line">console_enabled &#x3D; true</span><br><span class="line"></span><br><span class="line">[SHARD]</span><br><span class="line">shard_enabled &#x3D; true</span><br><span class="line">bind_ip &#x3D; 绑定ip</span><br><span class="line">master_ip &#x3D; 主服务器的ip</span><br><span class="line">master_port &#x3D; 主服务器的通信端口</span><br><span class="line">cluster_key &#x3D; 集群内部通信密码</span><br></pre></td></tr></table></figure>

<p>下面分别解释所有可设置项。<br>注意：未必每一项都要设置，如果没有在 cluster.ini 中特别设置，则默认此项使用「默认值」。</p>
<h4 id="MISC-杂项"><a href="#MISC-杂项" class="headerlink" title="MISC 杂项"></a><code>MISC</code> 杂项</h4><h5 id="max-snapshots-最大快照数量"><a href="#max-snapshots-最大快照数量" class="headerlink" title="max_snapshots 最大快照数量"></a><code>max_snapshots</code> 最大快照数量</h5><p>默认值：<code>6</code><br>默认情况下每天日出的时候会自动保存一个快照，这项设置是设置总共允许保留几个快照。</p>
<p>可以在游戏中按「Tab」键打开记分板，然后点击「服务器操作」，再选择「回滚」回到上一个快照。<br><img src="https://i.loli.net/2020/04/09/gDv6noF7drPxVfq.png" alt="服务器操作.png"><br><img src="https://i.loli.net/2020/04/09/mLPNolpSvkjE457.png" alt="服务器操作列表.png"></p>
<p>如果拥有管理员权限，也可以在「服务器的命令行界面」或者在游戏中打开「控制台」并用Ctrl键切换到远程控制台；<br>并输入<code>c_rollback(3)</code>回到三个快照之前。</p>
<blockquote>
<p>由于一般情况下是每天日出时自动保存快照，回滚三个快照版本一般意味着回到前天日出时。<br>（1-今天日出时、2-昨天日出时、3-前天日出时）<br>但你也可以使用<code>c_save()</code>手动将当前状态保存为快照，那么手动保存的快照也会被计入记录。</p>
</blockquote>
<h5 id="console-enabled-最大快照数量"><a href="#console-enabled-最大快照数量" class="headerlink" title="console_enabled 最大快照数量"></a><code>console_enabled</code> 最大快照数量</h5><p>默认值：<code>true</code><br>是否允许在「服务器的命令行界面」或者在游戏中打开「控制台」输入命令。</p>
<h4 id="SHARD-分片"><a href="#SHARD-分片" class="headerlink" title="SHARD 分片"></a><code>SHARD</code> 分片</h4><h5 id="shard-enabled-是否启用分片架构"><a href="#shard-enabled-是否启用分片架构" class="headerlink" title="shard_enabled 是否启用分片架构"></a><code>shard_enabled</code> 是否启用分片架构</h5><p>默认值：<code>false</code><br>前面一节已经解释过什么是分片架构、分片架构如何运行了。</p>
<p>简单来说就是如果要启用多层服务器（主服务器+地穴服务器=2），这个选项必须设置为<code>true</code>。<br>如果不开地穴服务器，只开主服务器（地面服务器）就不用管。</p>
<h5 id="bind-ip-绑定监听IP"><a href="#bind-ip-绑定监听IP" class="headerlink" title="bind_ip 绑定监听IP"></a><code>bind_ip</code> 绑定监听IP</h5><p><strong>可以被server.ini覆盖</strong></p>
<blockquote>
<p>什么叫覆盖？尽管cluster.ini已经设置过了<br>但如果server.ini中有不同的设置，以server.ini为准<br>下同</p>
</blockquote>
<p>默认值：<code>127.0.0.1</code><br>前提：<code>shard_enabled</code> = <code>true</code> 而且 <code>is_master</code> = <code>true</code> 此项设置才会生效<br>「主服务器」监听的「从服务器」连接过来的IP，默认的<code>127.0.0.1</code>是本地的意思，假如地穴服务器和主服务器在同一台服务器（物理机）上，不用管这个选项。<br>如果是「多服务器单集群」架构，即地穴服务器在另一台服务器上，需要修改为<code>0.0.0.0</code>（监听所有IP，确切的说是ipv4）。<br>理论上专门限定「从服务器」的IP也行（但没有必要，如果注重安全可以设置<code>cluster_key</code>）。</p>
<h5 id="master-ip-主服务器IP"><a href="#master-ip-主服务器IP" class="headerlink" title="master_ip 主服务器IP"></a><code>master_ip</code> 主服务器IP</h5><p><strong>可以被server.ini覆盖</strong><br>默认值：<code>none</code><br>前提：<code>shard_enabled</code> = <code>true</code> 而且 <code>is_master</code> = <code>false</code><br>（注意<code>is_master</code>需要为false，也就是说上一个选项只在Master生效，这个选项只在Caves生效）<br>主服务器和地穴服务器在同一台物理机服务器上填<code>127.0.0.1</code>，否则填主服务器的IP。</p>
<p>顺便提一下，如果主服务器和地穴服务器在同一个局域网，填内网IP即可。<br>比如家里有服务器，填路由器分发的内网IP；或者是某某云<strong>同一个子网内</strong>的两台VPS，填内网IP即可。<br>（使用内网通信可以提高一定的通信速度和安全性。）<br>如果不是，则必须填主服务器的公网IP。<br><strong>如果实在弄不清楚，也别整那些花里胡哨的，直接填外网IP就完事了。</strong></p>
<h5 id="master-port-主服务器集群内部通信端口"><a href="#master-port-主服务器集群内部通信端口" class="headerlink" title="master_port 主服务器集群内部通信端口"></a><code>master_port</code> 主服务器集群内部通信端口</h5><p><strong>可以被server.ini覆盖</strong><br>默认值: <code>10888</code><br>主服务器会持续监听这个<strong>UDP</strong>端口，所有尚未连接到主服务器的分片「从服务器」都会尝试用这个端口连接到主服务器。</p>
<p>突然不知道怎么形容了……用人话说：这个端口是主服务器和其他分片服务器之间通信的端口。<br>这意味什么？</p>
<ol>
<li>「饥荒游戏客户端」主要的通信数据不是走的这个端口，走的是Master/Caves的<code>server.ini</code>里设置的<code>server_port</code>，<strong>所以<code>cluster.ini</code>的<code>master_port</code>和<code>server.ini</code>的<code>server_port</code>不能是同一个端口</strong>。</li>
<li>不管有几个分片服务器，主服务器、地穴服务器、天上服务器、天下服务器、天上天下天地无双服务器，<strong>所有分片服务器的<code>cluster.ini</code>中的<code>master_port</code>都是同一个端口</strong>。</li>
</ol>
<h5 id="cluster-key-集群内部通信密码"><a href="#cluster-key-集群内部通信密码" class="headerlink" title="cluster_key 集群内部通信密码"></a><code>cluster_key</code> 集群内部通信密码</h5><p><strong>可以被server.ini覆盖</strong><br>默认值: <code>none</code><br>前提：<code>shard_enabled</code> = <code>true</code><br>如果设置了，「从服务器」试图连接到「主服务器」时会验证这个密码。<br>别的不用多说了吧，比如要配置要统一什么的，都不是同一个密码还连个P。</p>
<p>这个有什么用，想象一下，你服务器的公网IP和端口都是公开的（不然也Steam和Klei也连不上你的服务器），假如有一个人知道了你的IP和端口，<strong>如果没有设置<code>cluster_key</code></strong>，他完全可以搞一个服务器假装是你的「从服务器」来连你。<br>（当然，如果他想成功连上必须保证他的<code>cluster.ini</code>和你的主服务器的能对得上，其实这本身就相当于一道密码了。）<br>另外连上了能做什么，我也不太清楚，我就这么一提，客观上有这么一种可能性。<br>其实也没什么在意的必要，你的服务器又不是日流水几千上万，谁有这么闲摸过来找你搞事。<br>（L4D2就未必了，我开个小服还设置了Steam组成员限定，有没有必要D啊？动了谁的蛋糕？还是脚本小子学了新活拿我练手？）</p>
<h4 id="STEAM-Steam-相关"><a href="#STEAM-Steam-相关" class="headerlink" title="STEAM Steam 相关"></a><code>STEAM</code> Steam 相关</h4><h5 id="steam-group-only-Steam-组内成员限定"><a href="#steam-group-only-Steam-组内成员限定" class="headerlink" title="steam_group_only Steam 组内成员限定"></a><code>steam_group_only</code> Steam 组内成员限定</h5><p>默认值: <code>false</code><br>如果设置为true，则只有<code>steam_group_id</code>设置的 Steam 组内部的成员可以进入服务器。</p>
<h5 id="steam-group-id-Steam-组-ID"><a href="#steam-group-id-Steam-组-ID" class="headerlink" title="steam_group_id Steam 组 ID"></a><code>steam_group_id</code> Steam 组 ID</h5><p>默认值: <code>0</code><br>服务器绑定的Steam用户组ID。</p>
<h5 id="steam-group-admins-Steam-组管理员同步"><a href="#steam-group-admins-Steam-组管理员同步" class="headerlink" title="steam_group_admins Steam 组管理员同步"></a><code>steam_group_admins</code> Steam 组管理员同步</h5><p>默认值: <code>false</code><br>如果设置为true，则<code>steam_group_id</code>设置的 Steam 组的「组管理员」自动成为「本服务器的管理员」。</p>
<h4 id="NETWORK-网络"><a href="#NETWORK-网络" class="headerlink" title="NETWORK 网络"></a><code>NETWORK</code> 网络</h4><h5 id="offline-cluster-集群离线"><a href="#offline-cluster-集群离线" class="headerlink" title="offline_cluster 集群离线"></a><code>offline_cluster</code> 集群离线</h5><p>默认值: <code>false</code><br>如果设置为true，则服务器不会在Steam公共服务器列表显示，所有有关Steam的功能失效，且只有本地用户能够连接。</p>
<h5 id="tick-rate-Tick-速率"><a href="#tick-rate-Tick-速率" class="headerlink" title="tick_rate Tick 速率"></a><code>tick_rate</code> Tick 速率</h5><p>默认值: <code>15</code><br>服务器刷新频率，需要为60的除数，即15、20、30。</p>
<p>简单科普一下，任何游戏都会涉及数值计算，怎么算，把「玩家与系统之间的交互状态」量化为数据然后算。<br>最直观的，攻速属性：系统告诉你，你攻速是多少；它不可能随便说个数字，然后真实攻速搞成随机（除了游戏机制本身就是设计为随机浮动的攻速），它一定有一个标准，这个标准就是Tick。<br>游戏内部是有一个时钟来计算各种关于时间的数值的，一般可以分为运算帧和显示帧。</p>
<p>显示帧根据你物理机的配置不同也许有各种浮动，但一定是限定在一个范围内的。<br>你配置顶天了，你拿超算玩的游戏，也不可能比别人提前看一秒的游戏画面，即使人家机器总价2k，随便捡的二手亮机卡。<br>玩过梦幻西游类似网游的都知道（好像暴露年龄了），特别卡的时候游戏画面会卡住，但你能说连服务器计算数值都卡住了吗。<br>等不卡了，画面疯狂快进到当前时刻，这就是显示归显示，数值计算归数值计算。</p>
<p>运算帧同理，游戏服务器肯定有一个标准来计算攻击间隔啦、技能CD啦、buff时间啦。<br>主打竞技性的射击游戏对这个值是最敏感的，比如要算「射速计算+距离计算+运动速度计算=横向提前量计算=命中判定」，甚至更细的「+重力加速度=纵向提前量计算=命中判定」，另外还有用「开枪后准心高度随机上扬」来表现的后坐力等等一大堆复杂机制，全都要吃运算帧。</p>
<p>最典型的FPS，CSGO一般的刷新率是64 Tick，比赛服128 Tick。<br>相对来说多人开放世界沙盒由于涉及的计算属性繁杂，而且也不太吃运算细节，而是整个沙盒世界综合起来的总体反馈。<br>你玩饥荒会在意攻速具体到小数点后两位是多少吗，还不是打二走一就完事了。<br>FPS就不得不在意，决赛生死局的一发神经枪从128 Tick 换成64 Tick 说不定真的就射失了；射击游戏要走竞技这条路，如果这方面做得不好就没人玩。</p>
<p>假如玩个Minecraft，本来出生区块就是255空岛的高空流水，地下全是高频红石自动农场，你还要逼服务器抽出资源来算你掠夺3补刀刷怪塔掉的空血怪是不是晚死了0.082秒，那也太过分了。<br>我记得之前玩的MC服，还是1.14.4那个卡比版本，同时在线30+，提倡每个区块6实体以下人走红石停，卡起来TPS不到10；人少一点10+可以到15 TPS（已经算流畅了，用颜色表示就是绿色），更少甚至可以20。</p>
<p>我说这么多就是为了表示，<strong>饥荒服务器15 tick的默认值一般不用改，假如能够一直稳定15帧，体验就已经极流畅了</strong>。<br>调高TPS意味着服务器运算量提高乃至翻倍，结果给你带来的游戏体验未必会更流畅，放过服务器吧。<br>我不想爽玩30 TPS的服吗？带不动啊。不说别的，6人联机能够稳定15真的够了。</p>
<blockquote>
<p>P.S. 大型网游，尤其是3D的MMORPG，百人同屏特效乱飞那种也会很低，比如剑网3的运算帧就只有1秒16帧。<br>攻速、技能读条时间、技能CD时间、<del>buff持续时间</del> 好像没有这个、dot/hot跳数全是在此之上计算的。</p>
</blockquote>
<h5 id="whitelist-slots-VIP-席位数量"><a href="#whitelist-slots-VIP-席位数量" class="headerlink" title="whitelist_slots VIP 席位数量"></a><code>whitelist_slots</code> VIP 席位数量</h5><p>默认值: <code>0</code><br>直接打比方吧，假如现在<code>max_players</code>=15，<code>whitelist_slots</code>=5，那么当有10个路人玩家加进来之后，第11个路人玩家就无法再加入服务器了，只有白名单里的玩家可以继续加入服务器。<br>如果<code>max_players</code>=10，<code>whitelist_slots</code>=10，那么只有白名单内的玩家可以加入服务器。</p>
<p>白名单用<code>whitelist.txt</code>设置，里面写的是「Klei 的User ID（<code>KU_</code>开头那个）」或者「Steam 64位 ID」，每行一个，<code>whitelist.txt</code>文件和<code>cluster.ini</code>文件放在同一个目录下。</p>
<h5 id="cluster-password-集群外部连接密码"><a href="#cluster-password-集群外部连接密码" class="headerlink" title="cluster_password 集群外部连接密码"></a><code>cluster_password</code> 集群外部连接密码</h5><p>默认值: <code>none</code><br>设置之后必须玩家使用这个密码才能加入服务器，不需要密码留空即可。</p>
<h5 id="cluster-name-集群外部名称"><a href="#cluster-name-集群外部名称" class="headerlink" title="cluster_name 集群外部名称"></a><code>cluster_name</code> 集群外部名称</h5><p>显示在游戏里服务器列表里的名字。</p>
<h5 id="cluster-description-集群外部描述"><a href="#cluster-description-集群外部描述" class="headerlink" title="cluster_description 集群外部描述"></a><code>cluster_description</code> 集群外部描述</h5><p>默认值: <code>empty</code><br>在游戏里点击某个服务器之后，显示在右边的「服务器详细信息」里的内容。</p>
<h5 id="lan-only-cluster-集群只对lan可用"><a href="#lan-only-cluster-集群只对lan可用" class="headerlink" title="lan_only_cluster 集群只对lan可用"></a><code>lan_only_cluster</code> 集群只对lan可用</h5><p>默认值: <code>false</code><br>如果设置为true，则服务器只允许同一个局域网下的玩家进入。</p>
<p>用Windows开服，并且只想让室友进服的玩家也许会用到这个设置项？<br>买VPS的用户无视即可，你总不能接进某某云内网玩游戏吧。</p>
<h5 id="cluster-intention-集群目标"><a href="#cluster-intention-集群目标" class="headerlink" title="cluster_intention 集群目标"></a><code>cluster_intention</code> 集群目标</h5><p>显示服务器的游戏风格是什么：</p>
<ul>
<li><strong>social</strong> 社交</li>
<li><strong>cooperative</strong> 合作</li>
<li><strong>competitive</strong> 竞争</li>
<li><strong>madness</strong> 疯狂</li>
</ul>
<h5 id="autosaver-enabled-是否启用自动快照"><a href="#autosaver-enabled-是否启用自动快照" class="headerlink" title="autosaver_enabled 是否启用自动快照"></a><code>autosaver_enabled</code> 是否启用自动快照</h5><p>默认值: <code>true</code><br>如果设置为false，则服务器不再于每天日出时保存快照。</p>
<p>当然，当服务器关闭、或者手动运行<code>c_save()</code>时仍然会保存。</p>
<h4 id="GAMEPLAY-游玩相关"><a href="#GAMEPLAY-游玩相关" class="headerlink" title="GAMEPLAY 游玩相关"></a>GAMEPLAY 游玩相关</h4><h5 id="max-players-最大玩家数量"><a href="#max-players-最大玩家数量" class="headerlink" title="max_players 最大玩家数量"></a><code>max_players</code> 最大玩家数量</h5><p>默认值: <code>16</code><br>允许<strong>同时</strong>连接到此服务器的玩家的总数。</p>
<h5 id="pvp-是否允许PVP"><a href="#pvp-是否允许PVP" class="headerlink" title="pvp 是否允许PVP"></a><code>pvp</code> 是否允许PVP</h5><p>默认值: <code>false</code><br>如果设置为true，则服务器允许玩家之间互相伤害。</p>
<h5 id="game-mode-游戏模式"><a href="#game-mode-游戏模式" class="headerlink" title="game_mode 游戏模式"></a><code>game_mode</code> 游戏模式</h5><p>默认值: <code>survival</code></p>
<ul>
<li><strong>survival</strong> 生存<br>新玩家出生在恶魔之门，死亡之后变成鬼魂，鬼魂会导致活着的玩家掉san，所有人都死光后整个世界重置</li>
<li><strong>wilderness</strong> 荒野<br>新玩家出生在随机位置，死亡之后不会变成鬼魂，直接reroll角色重来</li>
<li><strong>endless</strong> 无穷无尽<br>新玩家出生在恶魔之门，死亡之后变成鬼魂，鬼魂摸恶魔之门可以直接复活，即使所有人死光世界也不会重置</li>
</ul>
<h5 id="pause-when-empty-是否启用闲置时暂停"><a href="#pause-when-empty-是否启用闲置时暂停" class="headerlink" title="pause_when_empty 是否启用闲置时暂停"></a><code>pause_when_empty</code> 是否启用闲置时暂停</h5><p>默认值: <code>false</code><br>如果设置为true，则服务器会在最后一个玩家退出后暂停整个世界。<strong>强烈建议开启</strong></p>
<h5 id="vote-enabled-是否启用投票机制"><a href="#vote-enabled-是否启用投票机制" class="headerlink" title="vote_enabled 是否启用投票机制"></a><code>vote_enabled</code> 是否启用投票机制</h5><p>默认值: <code>true</code><br>如果设置为false，则服务器禁用玩家投票功能。</p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>总之所有分片服务器的<code>cluster.ini</code>设置要一致，不能说主服务器无所谓<code>whitelist_slots</code>=0，但是地穴服务器要留一个VIP席位<code>whitelist_slots</code>=1，<strong>这样是不行的</strong>。<br>如果某个选项对你来说默认值就可以，可以忽略这一项配置，从而使用默认值。</p>
<h3 id="server-ini-分片服务端设置"><a href="#server-ini-分片服务端设置" class="headerlink" title="server.ini 分片服务端设置"></a>server.ini 分片服务端设置</h3><h4 id="SHARD-分片-1"><a href="#SHARD-分片-1" class="headerlink" title="SHARD 分片"></a><code>SHARD</code> 分片</h4><h5 id="is-master-是否为主服务器"><a href="#is-master-是否为主服务器" class="headerlink" title="is_master 是否为主服务器"></a><code>is_master</code> 是否为主服务器</h5><p>默认值: <code>none</code><br>前提：<code>shard_enabled</code> = <code>true</code><br>将一个分片服务端设置为主服务器，每个集群中只有一个主服务器。</p>
<p>主服务器（Master）的<code>server.ini</code>中此项设置为true，其他分片（Caves）的<code>server.ini</code>中此项设置为false。</p>
<h5 id="name-分片服务端名称"><a href="#name-分片服务端名称" class="headerlink" title="name 分片服务端名称"></a><code>name</code> 分片服务端名称</h5><p>默认值: <code>none</code><br>前提：<code>shard_enabled</code> = <code>true</code> 而且 <code>is_master</code> = <code>false</code><br>命令行终端输出日志时显示的分片服务端名称。</p>
<p>主服务器会忽略这项设置，强制为<code>SHDMASTER</code>。</p>
<h5 id="id-分片服务端-ID"><a href="#id-分片服务端-ID" class="headerlink" title="id 分片服务端 ID"></a><code>id</code> 分片服务端 ID</h5><p>默认值: <code>一串随机生成的数字</code><br>主服务器之外的分片服务端会自动生成这一项，用来标识在整个集群中的唯一性。</p>
<h4 id="STEAM-Steam-相关-1"><a href="#STEAM-Steam-相关-1" class="headerlink" title="STEAM Steam 相关"></a><code>STEAM</code> Steam 相关</h4><h5 id="authentication-port-鉴权端口"><a href="#authentication-port-鉴权端口" class="headerlink" title="authentication_port 鉴权端口"></a><code>authentication_port</code> 鉴权端口</h5><p>默认值: <code>8766</code><br>Steam使用的网络端口。<br>整个集群（即主服务器和地穴服务器同时）运行在同一台物理机服务器上时，不同的分片服务端<code>authentication_port</code>要使用不同的端口。</p>
<h5 id="master-server-port-作用不明我也不知道怎么翻译好"><a href="#master-server-port-作用不明我也不知道怎么翻译好" class="headerlink" title="master_server_port 作用不明我也不知道怎么翻译好"></a><code>master_server_port</code> 作用不明我也不知道怎么翻译好</h5><p>默认值: <code>27016</code><br>Steam使用的网络端口。</p>
<p>整个集群（即主服务器和地穴服务器同时）运行在同一台物理机服务器上时，不同的分片服务端<code>master_server_port</code>要使用不同的端口。</p>
<h4 id="NETWORK-网络-1"><a href="#NETWORK-网络-1" class="headerlink" title="NETWORK 网络"></a><code>NETWORK</code> 网络</h4><h5 id="server-port-服务器真正的服务端口"><a href="#server-port-服务器真正的服务端口" class="headerlink" title="server_port 服务器真正的服务端口"></a><code>server_port</code> 服务器真正的服务端口</h5><p>默认值: <code>10999</code><br>真正持续监听饥荒游戏客户端连接的<strong>UDP</strong>端口。</p>
<p><strong>有几个注意点</strong>：</p>
<ol>
<li>整个集群（即主服务器和地穴服务器同时）运行在同一台物理机服务器上时，不同的分片服务端<code>server_port</code>要使用不同的端口。</li>
<li>这个端口走的是 <strong>UDP</strong> 流量，开防火墙和安全组的时候别开成TCP协议了。</li>
<li>DST游戏<strong>客户端</strong>与<strong>服务端</strong>真正通信的时候访问的就是这个端口。<br>Steam 设置 Don’t Starve Together 启动选项直接连接服务器的时候用的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+connect 主服务器IP:本端口</span><br></pre></td></tr></table></figure>
或者<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+connect 主服务器IP:本端口 +password &quot;集群密码&quot;</span><br></pre></td></tr></table></figure>
的端口就是<strong>主服务器（Master）</strong>的<code>server.ini</code>里的<code>server_port</code>。<br>其他端口会显示服务器游戏版本与本地不一致 <del>我试过了</del>。</li>
<li>理论上说设置为任何端口（1-65535）都能跑，但是：  <ul>
<li>推荐设置为10998-11018之间，否则游戏内服务器列表界面可能会显示「延迟???」</li>
<li>不建议使用小于1024的端口，在某些操作系统上可能会出现权限问题</li>
</ul>
</li>
</ol>
<h2 id="其他常见问题"><a href="#其他常见问题" class="headerlink" title="其他常见问题"></a>其他常见问题</h2><h3 id="最低配置"><a href="#最低配置" class="headerlink" title="最低配置"></a>最低配置</h3><p>根据<a href="https://dontstarve.fandom.com/wiki/Guides/Don%E2%80%99t_Starve_Together_Dedicated_Servers#Requirements" target="_blank" rel="noopener">Wiki</a>有：</p>
<ul>
<li><strong>CPU</strong> 无所谓</li>
<li><strong>内存</strong> 每个玩家消耗 65MB</li>
<li><strong>上传带宽</strong> 每个玩家消耗 8KB/s</li>
</ul>
<h3 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h3><p>有白名单自然也有黑名单，和白名单的用法一样，<code>blocklist.txt</code>放在和<code>cluster.ini</code>同一个目录下。<br>在游戏中，管理员按「Tab」出记分板上面的有踢和封禁按钮，用封禁按钮ban掉的人也是加入的这个文件。</p>
<h3 id="管理员"><a href="#管理员" class="headerlink" title="管理员"></a>管理员</h3><p>和白名单/黑名单的用法一样，<code>adminlist.txt</code>放在和<code>cluster.ini</code>同一个目录下。<br>注意提供给<code>cluster_token.txt</code>的token其实是带了玩家的Klei ID 的，也就是说提供token的玩家自动默认为管理员。</p>
<h3 id="Mods"><a href="#Mods" class="headerlink" title="Mods"></a>Mods</h3><h4 id="下载-Mod"><a href="#下载-Mod" class="headerlink" title="下载 Mod"></a>下载 Mod</h4><p>首先要在饥荒服务端对应目录下载mod。<br>如果按照上面说的的攻略部署的服务器，应该是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/dontstarvetogether_dedicated_server/mods</span><br><span class="line">$ vim dedicated_server_mods_setup.lua</span><br></pre></td></tr></table></figure>
<p>然后添加要使用的mod即可：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerModSetup(<span class="string">"Mod ID"</span>) <span class="comment">--这样是lua的注释 记不清哪个mod是什么可以这样标记一下</span></span><br></pre></td></tr></table></figure>
<p>推荐自己到创意工坊新建一个合集：（然后增减Mod就可以在创意工坊页面完成了，而不必每次手动编辑文件）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerModCollectionSetup(<span class="string">"合集ID"</span>)</span><br></pre></td></tr></table></figure>
<p>设置完后启动服务器只是会自动从Steam下载而已，如果要真正启用还要另外编辑。</p>
<h4 id="启用-Mod"><a href="#启用-Mod" class="headerlink" title="启用 Mod"></a>启用 Mod</h4><p>可以编辑（和<code>dedicated_server_mods_setup.lua</code>同级目录）的<code>modsettings.lua</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ForceEnableMod(<span class="string">"强制启用的Mod"</span>)</span><br></pre></td></tr></table></figure>

<p>更推荐使用覆写配置的方式，打开 Master/Caves 目录下的 <code>modoverrides.lua</code>（没有就新建一个）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="comment">--前提是已经下好了 ~/dontstarvetogether_dedicated_server/mods 目录下有对应的文件夹就是下好了</span></span><br><span class="line">  [<span class="string">"workshop-375859599"</span>] = &#123; enabled = <span class="literal">true</span> &#125;, <span class="comment">--血条提示</span></span><br><span class="line">  [<span class="string">"workshop-378160973"</span>] = &#123; enabled = <span class="literal">true</span> &#125;, <span class="comment">--GPS</span></span><br><span class="line">  [<span class="string">"workshop-666155465"</span>] = &#123; enabled = <span class="literal">true</span> &#125;  <span class="comment">--显示提示</span></span><br><span class="line">  <span class="comment">--注意最后一项没有逗号                       ↑ 没有逗号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置-Mod"><a href="#配置-Mod" class="headerlink" title="配置 Mod"></a>配置 Mod</h4><p>如果要配置Mod，也可以用 <code>modoverrides.lua</code> 写，比如：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"workshop-666155465"</span>]=&#123; <span class="comment">--显示提示</span></span><br><span class="line">  configuration_options=&#123;</span><br><span class="line">    chestB=<span class="number">-1</span>,</span><br><span class="line">    chestG=<span class="number">-1</span>,</span><br><span class="line">    chestR=<span class="number">-1</span>,</span><br><span class="line">    food_estimation=<span class="number">-1</span>,</span><br><span class="line">    food_order=<span class="number">1</span>,</span><br><span class="line">    food_style=<span class="number">0</span>,</span><br><span class="line">    lang=<span class="string">"chs"</span>,</span><br><span class="line">    show_food_units=<span class="number">-1</span>,</span><br><span class="line">    show_uses=<span class="number">-1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  enabled=<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="上传文件权限问题"><a href="#上传文件权限问题" class="headerlink" title="上传文件权限问题"></a>上传文件权限问题</h3><ul>
<li>如果用WinSCP上传了文件</li>
<li>WinSCP传文件的时候还是用的 root 用户</li>
<li>但运行服务端的用户又不是root用户</li>
</ul>
<p>建议确保权限正确。<br>使用root登录SSH：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果新建的专门跑服务端的用户叫 steam</span></span><br><span class="line">$ chown -R steam:steam /home/steam/.klei/DoNotStarveTogether/MyDediServer/Cluster_1</span><br></pre></td></tr></table></figure>

<h3 id="端口问题"><a href="#端口问题" class="headerlink" title="端口问题"></a>端口问题</h3><h4 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h4><p>假如是「单服务器单集群」架构，那么你会有七个相关端口：</p>
<ul>
<li>Master 的 <code>master_port</code></li>
<li>Master 的 <code>server_port</code></li>
<li>Master 的 <code>authentication_port</code></li>
<li>Master 的 <code>master_server_port</code></li>
<li>Caves 的 <code>server_port</code></li>
<li>Caves 的 <code>authentication_port</code></li>
<li>Caves 的 <code>master_server_port</code></li>
</ul>
<p>七个端口都必须不同。</p>
<p>假如是「多服务器单集群」架构，那么「主服务器」上有四个端口，「地穴服务器」上有三个端口。<br>主服务器和地穴服务器上的对应端口也许可以相同（我没有试过），但没有必要。<br>何必呢，分别设置七个端口有那么难吗？</p>
<p>打个比方：</p>
<ul>
<li>Master 的 <code>master_port</code> 使用 <code>11000</code></li>
<li>Master 的 <code>server_port</code> 使用 <code>11001</code></li>
<li>Master 的 <code>authentication_port</code> 使用 <code>11002</code></li>
<li>Master 的 <code>master_server_port</code> 使用 <code>11003</code></li>
<li>Caves 的 <code>server_port</code> 使用 <code>11004</code></li>
<li>Caves 的 <code>authentication_port</code> 使用 <code>11005</code></li>
<li>Caves 的 <code>master_server_port</code> 使用 <code>11006</code></li>
</ul>
<p>现在你知道，所有分片服务器上都要开三个端口，分别提供「游戏服务」和「Steam内部通信服务 * 2」。<br>主服务器上的是 1、2、3，地穴服务器上的是 4、5、6。<br>主服务器上还多一个端口，是提供「集群内部通信服务」的，是 0。（为什么不是1？嗯？……我就随便举个栗子）</p>
<p>那么主服务器打开0-3（包括0和3）四个端口就行，地穴服务器打开4-6三个端口就行，既好记，又方便使用。</p>
<h4 id="Linux-防火墙"><a href="#Linux-防火墙" class="headerlink" title="Linux 防火墙"></a>Linux 防火墙</h4><p>使用 root 用户连接到SSH：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ firewall-cmd --zone&#x3D;public --query-port&#x3D;查询的端口&#x2F;udp</span><br><span class="line"># 如果回显 no 说明对应端口没有打开，需要防火墙放通</span><br><span class="line">$ firewall-cmd --zone&#x3D;public --add-port&#x3D;放通的端口&#x2F;udp --permanent</span><br><span class="line"># 应该回显 success</span><br><span class="line">$ firewall-cmd --reload # 重载防火墙策略</span><br><span class="line">$ systemctl restart firewalld # 或者直接重启防火墙</span><br><span class="line">$ firewall-cmd --zone&#x3D;public --query-port&#x3D;再次查询端口&#x2F;udp</span><br><span class="line"># 应该回显 yes</span><br></pre></td></tr></table></figure>

<h4 id="IDC-服务商的安全组"><a href="#IDC-服务商的安全组" class="headerlink" title="IDC 服务商的安全组"></a>IDC 服务商的安全组</h4><p>阿里云、腾讯云、京东云、华为云、又拍云、筋斗云，不管什么云，它但凡是家有牌照的IDC商，肯定是提供安全组服务的。<br>这年头狗都会上网了，真的不建议放通所有端口。</p>
<blockquote>
<p>这两天斗鱼PM我说最近有先查主播IP然后D到不能开播的情况<br>实属离奇</p>
</blockquote>
<p><img src="https://i.loli.net/2020/04/09/iqTdz8WjMGURhI9.png" alt="斗鱼PM"></p>
<p>要用的上面全部写清楚了，又不是不知道具体该开放哪些端口，有衣服穿何必裸奔呢。<br>对应端口，UDP，0.0.0.0/0，允许，没了。</p>
<h2 id="其他不常见问题"><a href="#其他不常见问题" class="headerlink" title="其他不常见问题"></a>其他不常见问题</h2><p>下面两个问题都是CentOS出现的，不太清楚Debian能不能复现。</p>
<h3 id="缺少-libcurl-gnutls-so-4"><a href="#缺少-libcurl-gnutls-so-4" class="headerlink" title="缺少 libcurl-gnutls.so.4"></a>缺少 libcurl-gnutls.so.4</h3><p>感谢「<a href="https://blog.csdn.net/zhang41228/article/details/103106298" target="_blank" rel="noopener">Linux/Centos7搭建饥荒服务器教程</a>」一文的提出的解决方案。<br>如果依赖已经成功安装，但运行服务端仍然提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dontstarve_dedicated_server_nullrenderer: error <span class="keyword">while</span> loading shared libraries: libcurl-gnutls.so.4: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<p>这种情况是库文件链接错误，重新建立软链接就好了：<br>（注意<code>/home/steam</code>是当前用户的home目录，即<code>pwd ~</code>，若与教程不同请注意自行替换）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ln -s /usr/lib/libcurl.so.4 /home/steam/dontstarvetogether_dedicated_server/bin/lib32/libcurl-gnutls.so.4</span><br></pre></td></tr></table></figure>
<p>如果你确定当前用户就是steam（或者叫别的名字的专门运行服务端的用户）而不是root，也可以直接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ln -s /usr/lib/libcurl.so.4 ~/dontstarvetogether_dedicated_server/bin/lib32/libcurl-gnutls.so.4</span><br></pre></td></tr></table></figure>
<h3 id="内核版本过低"><a href="#内核版本过低" class="headerlink" title="内核版本过低"></a>内核版本过低</h3><p>新搞了个服务器，用来测试写的脚本，结果出了这个问题。</p>
<p>感谢「<a href="https://blog.csdn.net/baidu_36985483/article/details/103507215" target="_blank" rel="noopener">Centos7 在使用SteamCMD更新的时候显示登录成功||不成功，获取用户信息失败问题分析！解决方法</a>」一文的提出的解决方案。<br>查看「<a href="https://steamcommunity.com/discussions/forum/11/1646544161774102517" target="_blank" rel="noopener">[LINUX, STEAMCMD] Waiting for user info…FAILED. Timed out.</a>」一帖可以看到热心网友<a href="https://steamcommunity.com/id/neutralx2" target="_blank" rel="noopener">NeutralX2</a>表示他遇到了同样的问题，但已经解决了，是内核版本过新（他的情况是过新）的问题，并指路「<a href="https://github.com/ValveSoftware/steam-for-linux/issues/6326" target="_blank" rel="noopener">Steam does not connect on kernels newer than 2019-06-17 #6326</a>」。<br>总之出现类似问题多半是SteamCMD不支持当前的内核版本。</p>
<p>我这里的症状是SteamCMD解压好第一次运行的时候匿名登录上去了，但获取API时失败，大概像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Steam&gt;login anonymous</span><br><span class="line"></span><br><span class="line">Connecting anonymously to Steam Public...Logged in OK</span><br><span class="line">Waiting for user info...OK.</span><br><span class="line">Loading Steam API...FAILED. Timed out.</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>解决方案很简单，更新内核就好了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum update kernel</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>不记得参考了哪些，以前的我既然记在这里那应该都参考了，排名不分先后。<br><a href="https://github.com/moonprism/installDSTserver.sh" target="_blank" rel="noopener">moonprism的安装脚本</a><br><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1448397182" target="_blank" rel="noopener">Windows+Steam客户端，快速配置Dedicated Server</a><br><a href="https://www.jianshu.com/p/440d64cd3ac4" target="_blank" rel="noopener">饥荒联机版服务器搭建教程</a><br><a href="https://www.kicoe.com/article/id/4" target="_blank" rel="noopener">Linux下搭建饥荒专用服务器</a></p>
<h2 id="安装脚本"><a href="#安装脚本" class="headerlink" title="安装脚本"></a>安装脚本</h2><p>差点忘了说，顺手写了个脚本，就当复习shell基础了。<br>写的时候考虑尽善尽美了，不保证实际体验。<br>我还是觉得授人以<a href="https://github.com/Cyanashi/AutoTaskScripts/tree/master/Game/DoNotStarveTogether" target="_blank" rel="noopener">鱼</a>不如授人以渔。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y wget &amp;&amp; wget https://raw.githubusercontent.com/Cyanashi/AutoTaskScripts/master/Game/DoNotStarveTogether/install_dst.sh &amp;&amp; sh install_dst.sh</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Cyanashi
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://ews.ink/game/DST-Server-Deploy/" title="「游戏」有手就行的《饥荒联机版》专用服务器搭建及配置教程">https://ews.ink/game/DST-Server-Deploy/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF/" rel="tag"># 服务端</a>
              <a href="/tags/%E9%A5%A5%E8%8D%92/" rel="tag"># 饥荒</a>
              <a href="/tags/%E9%A5%A5%E8%8D%92%E8%81%94%E6%9C%BA%E7%89%88/" rel="tag"># 饥荒联机版</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/operation/Linux-SSH-Keys-Usage/" rel="prev" title="「运维」SSH-Key 的使用场景 Termux and Git">
      <i class="fa fa-chevron-left"></i> 「运维」SSH-Key 的使用场景 Termux and Git
    </a></div>
      <div class="post-nav-item">
    <a href="/game/Terraria-1.3.5.3/" rel="next" title="「游戏」《泰拉瑞亚》游玩流程">
      「游戏」《泰拉瑞亚》游玩流程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注意事项"><span class="nav-number">2.</span> <span class="nav-text">注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#时效性"><span class="nav-number">2.1.</span> <span class="nav-text">时效性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试环境"><span class="nav-number">2.2.</span> <span class="nav-text">测试环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#能用树莓派跑吗"><span class="nav-number">2.3.</span> <span class="nav-text">能用树莓派跑吗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本文篇幅问题"><span class="nav-number">2.4.</span> <span class="nav-text">本文篇幅问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完整流程"><span class="nav-number">3.</span> <span class="nav-text">完整流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装依赖"><span class="nav-number">3.1.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-CMD-版-Steam"><span class="nav-number">3.2.</span> <span class="nav-text">安装 CMD 版 Steam</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装DST（饥荒联机版）服务端"><span class="nav-number">3.3.</span> <span class="nav-text">安装DST（饥荒联机版）服务端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端架构简介"><span class="nav-number">3.4.</span> <span class="nav-text">服务端架构简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单服务器单集群"><span class="nav-number">3.4.1.</span> <span class="nav-text">单服务器单集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多服务器单集群"><span class="nav-number">3.4.2.</span> <span class="nav-text">多服务器单集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单服务器多集群"><span class="nav-number">3.4.3.</span> <span class="nav-text">单服务器多集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">3.4.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-token-txt-集群-Token"><span class="nav-number">3.5.</span> <span class="nav-text">cluster_token.txt 集群 Token</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#网页获取"><span class="nav-number">3.5.1.</span> <span class="nav-text">网页获取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#控制台"><span class="nav-number">3.5.2.</span> <span class="nav-text">控制台</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-ini-集群配置"><span class="nav-number">3.6.</span> <span class="nav-text">cluster.ini 集群配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MISC-杂项"><span class="nav-number">3.6.1.</span> <span class="nav-text">MISC 杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#max-snapshots-最大快照数量"><span class="nav-number">3.6.1.1.</span> <span class="nav-text">max_snapshots 最大快照数量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#console-enabled-最大快照数量"><span class="nav-number">3.6.1.2.</span> <span class="nav-text">console_enabled 最大快照数量</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SHARD-分片"><span class="nav-number">3.6.2.</span> <span class="nav-text">SHARD 分片</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#shard-enabled-是否启用分片架构"><span class="nav-number">3.6.2.1.</span> <span class="nav-text">shard_enabled 是否启用分片架构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#bind-ip-绑定监听IP"><span class="nav-number">3.6.2.2.</span> <span class="nav-text">bind_ip 绑定监听IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#master-ip-主服务器IP"><span class="nav-number">3.6.2.3.</span> <span class="nav-text">master_ip 主服务器IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#master-port-主服务器集群内部通信端口"><span class="nav-number">3.6.2.4.</span> <span class="nav-text">master_port 主服务器集群内部通信端口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cluster-key-集群内部通信密码"><span class="nav-number">3.6.2.5.</span> <span class="nav-text">cluster_key 集群内部通信密码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#STEAM-Steam-相关"><span class="nav-number">3.6.3.</span> <span class="nav-text">STEAM Steam 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#steam-group-only-Steam-组内成员限定"><span class="nav-number">3.6.3.1.</span> <span class="nav-text">steam_group_only Steam 组内成员限定</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#steam-group-id-Steam-组-ID"><span class="nav-number">3.6.3.2.</span> <span class="nav-text">steam_group_id Steam 组 ID</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#steam-group-admins-Steam-组管理员同步"><span class="nav-number">3.6.3.3.</span> <span class="nav-text">steam_group_admins Steam 组管理员同步</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NETWORK-网络"><span class="nav-number">3.6.4.</span> <span class="nav-text">NETWORK 网络</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#offline-cluster-集群离线"><span class="nav-number">3.6.4.1.</span> <span class="nav-text">offline_cluster 集群离线</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#tick-rate-Tick-速率"><span class="nav-number">3.6.4.2.</span> <span class="nav-text">tick_rate Tick 速率</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#whitelist-slots-VIP-席位数量"><span class="nav-number">3.6.4.3.</span> <span class="nav-text">whitelist_slots VIP 席位数量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cluster-password-集群外部连接密码"><span class="nav-number">3.6.4.4.</span> <span class="nav-text">cluster_password 集群外部连接密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cluster-name-集群外部名称"><span class="nav-number">3.6.4.5.</span> <span class="nav-text">cluster_name 集群外部名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cluster-description-集群外部描述"><span class="nav-number">3.6.4.6.</span> <span class="nav-text">cluster_description 集群外部描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lan-only-cluster-集群只对lan可用"><span class="nav-number">3.6.4.7.</span> <span class="nav-text">lan_only_cluster 集群只对lan可用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cluster-intention-集群目标"><span class="nav-number">3.6.4.8.</span> <span class="nav-text">cluster_intention 集群目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#autosaver-enabled-是否启用自动快照"><span class="nav-number">3.6.4.9.</span> <span class="nav-text">autosaver_enabled 是否启用自动快照</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GAMEPLAY-游玩相关"><span class="nav-number">3.6.5.</span> <span class="nav-text">GAMEPLAY 游玩相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#max-players-最大玩家数量"><span class="nav-number">3.6.5.1.</span> <span class="nav-text">max_players 最大玩家数量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pvp-是否允许PVP"><span class="nav-number">3.6.5.2.</span> <span class="nav-text">pvp 是否允许PVP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#game-mode-游戏模式"><span class="nav-number">3.6.5.3.</span> <span class="nav-text">game_mode 游戏模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pause-when-empty-是否启用闲置时暂停"><span class="nav-number">3.6.5.4.</span> <span class="nav-text">pause_when_empty 是否启用闲置时暂停</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vote-enabled-是否启用投票机制"><span class="nav-number">3.6.5.5.</span> <span class="nav-text">vote_enabled 是否启用投票机制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-1"><span class="nav-number">3.6.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server-ini-分片服务端设置"><span class="nav-number">3.7.</span> <span class="nav-text">server.ini 分片服务端设置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SHARD-分片-1"><span class="nav-number">3.7.1.</span> <span class="nav-text">SHARD 分片</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#is-master-是否为主服务器"><span class="nav-number">3.7.1.1.</span> <span class="nav-text">is_master 是否为主服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#name-分片服务端名称"><span class="nav-number">3.7.1.2.</span> <span class="nav-text">name 分片服务端名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#id-分片服务端-ID"><span class="nav-number">3.7.1.3.</span> <span class="nav-text">id 分片服务端 ID</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#STEAM-Steam-相关-1"><span class="nav-number">3.7.2.</span> <span class="nav-text">STEAM Steam 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#authentication-port-鉴权端口"><span class="nav-number">3.7.2.1.</span> <span class="nav-text">authentication_port 鉴权端口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#master-server-port-作用不明我也不知道怎么翻译好"><span class="nav-number">3.7.2.2.</span> <span class="nav-text">master_server_port 作用不明我也不知道怎么翻译好</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NETWORK-网络-1"><span class="nav-number">3.7.3.</span> <span class="nav-text">NETWORK 网络</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#server-port-服务器真正的服务端口"><span class="nav-number">3.7.3.1.</span> <span class="nav-text">server_port 服务器真正的服务端口</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他常见问题"><span class="nav-number">4.</span> <span class="nav-text">其他常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#最低配置"><span class="nav-number">4.1.</span> <span class="nav-text">最低配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#黑名单"><span class="nav-number">4.2.</span> <span class="nav-text">黑名单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#管理员"><span class="nav-number">4.3.</span> <span class="nav-text">管理员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mods"><span class="nav-number">4.4.</span> <span class="nav-text">Mods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#下载-Mod"><span class="nav-number">4.4.1.</span> <span class="nav-text">下载 Mod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用-Mod"><span class="nav-number">4.4.2.</span> <span class="nav-text">启用 Mod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置-Mod"><span class="nav-number">4.4.3.</span> <span class="nav-text">配置 Mod</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传文件权限问题"><span class="nav-number">4.5.</span> <span class="nav-text">上传文件权限问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#端口问题"><span class="nav-number">4.6.</span> <span class="nav-text">端口问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概括"><span class="nav-number">4.6.1.</span> <span class="nav-text">概括</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux-防火墙"><span class="nav-number">4.6.2.</span> <span class="nav-text">Linux 防火墙</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IDC-服务商的安全组"><span class="nav-number">4.6.3.</span> <span class="nav-text">IDC 服务商的安全组</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他不常见问题"><span class="nav-number">5.</span> <span class="nav-text">其他不常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缺少-libcurl-gnutls-so-4"><span class="nav-number">5.1.</span> <span class="nav-text">缺少 libcurl-gnutls.so.4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内核版本过低"><span class="nav-number">5.2.</span> <span class="nav-text">内核版本过低</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装脚本"><span class="nav-number">7.</span> <span class="nav-text">安装脚本</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Cyanashi"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Cyanashi</p>
  <div class="site-description" itemprop="description">Always Sometimes Monsters</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:po@ews.ink" title="E-Mail → mailto:po@ews.ink"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/Cyanashi" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;Cyanashi" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/Cyanashi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Cyanashi" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bgm.tv/user/rakuyo" title="Bangumi → https:&#x2F;&#x2F;bgm.tv&#x2F;user&#x2F;rakuyo" rel="noopener" target="_blank"><i class="fa fa-fw fa-tv"></i>Bangumi</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tool.ews.ink/" title="Tools → https:&#x2F;&#x2F;tool.ews.ink" rel="noopener" target="_blank"><i class="fa fa-fw fa-wrench"></i>Tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198186170037" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198186170037" rel="noopener" target="_blank"><i class="fa fa-fw fa-steam"></i>Steam</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-paw"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyanashi All Rights Reserved.</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">98k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:13</span>
</div><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备17037841号-1 </a>
  <span class="post-meta-divider">|</span>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme - <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.1
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量 UV">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量 PV">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>

<span class="post-meta-divider">|</span>
<!-- 在网页底部添加网站运行时间 -->
<span id="timeDate">载入天数...&ensp;</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("10/18/2018 15:04:17");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "已运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
